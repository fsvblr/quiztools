import{a as c,o as n,v as I,b as r,t as f,e as O,x as m,F as $,h as x,f as p,g as l,_ as k,q as g,m as S,y as U,z as T,A as z,s as v}from"./vendor.min.js";const _=(t,e)=>{const i=t.__vccOpts||t;for(const[o,s]of e)i[o]=s;return i},F={props:{numberCurrentQuestion:{type:Number,default:0},totalQuestions:{type:Number,default:0}},inject:["Joomla"]},N={id:"quiz-count-questions",class:"quiz-count-questions"},P={id:"quiz-number-current"},M={id:"quiz-number-total"};function A(t,e,i,o,s,u){return n(),c("div",N,[I(f(u.Joomla.Text._("COM_QUIZTOOLS_QUIZ_COMPONENT_COUNT_QUESTIONS_TEXT_QUESTION"))+" ",1),r("span",P,f(this.numberCurrentQuestion),1),I(" "+f(u.Joomla.Text._("COM_QUIZTOOLS_QUIZ_COMPONENT_COUNT_QUESTIONS_TEXT_OF"))+" ",1),r("span",M,f(this.totalQuestions),1)])}const J=_(F,[["render",A]]),Z={props:{pointsCurrentQuestion:{type:Number,default:0}},inject:["Joomla"]},E={id:"quiz-answer-points",class:"quiz-answer-points"};function B(t,e,i,o,s,u){return n(),c("div",E,[I(f(u.Joomla.Text._("COM_QUIZTOOLS_QUIZ_COMPONENT_ANSWER_POINTS_TEXT_POINTS"))+" ",1),r("span",null,f(this.pointsCurrentQuestion?this.pointsCurrentQuestion:0),1)])}const D=_(Z,[["render",B]]),R={data(){return{displayedTime:"00:00:00",timer:null}},props:{timerStyle:{type:Number,default:0},limitTime:{type:Number,default:0},sumTimeSpent:{type:Number,default:0}},inject:["Joomla"],methods:{calculationTimePeriods(t){let e=(t%60).toString(),i=Math.floor(t/60%60).toString();return{h:Math.floor(t/60/60%60).toString(),m:i,s:e}},getTimeFormat(t){let e=this.calculationTimePeriods(t);return`${e.h.padStart(2,"0")}:${e.m.padStart(2,"0")}:${e.s.padStart(2,"0")}`},getTimeFormatWithLimit(t){let e=this.getTimeFormat(t),i=this.getTimeFormat(parseInt(this.limitTime)*60);return e+'<span class="quiz-timer__limit">'+Joomla.Text._("COM_QUIZTOOLS_QUIZ_COMPONENT_TIMER_TEXT_OF")+i+"</span>"},changeTime(){let t=parseInt(this.limitTime)*60-parseInt(this.sumTimeSpent);if(t<0){clearInterval(this.timer),this.timer=null,Joomla.renderMessages({warning:[Joomla.Text._("COM_QUIZTOOLS_QUIZ_ERROR_QUIZ_TIME_UP")]}),this.$emit("update-action","finish");return}this.timerStyle===0?this.displayedTime=this.getTimeFormat(this.sumTimeSpent):this.timerStyle===1?this.displayedTime=this.getTimeFormat(t):this.timerStyle===2&&(this.displayedTime=this.getTimeFormatWithLimit(this.sumTimeSpent)),this.$emit("update-sumTimeSpent",this.sumTimeSpent+1)}},mounted(){this.timer||(this.timer=setInterval(this.changeTime,1e3))}},H=["innerHTML"];function V(t,e,i,o,s,u){return n(),c("div",{id:"quiz-timer",class:"quiz-timer",innerHTML:this.displayedTime},null,8,H)}const j=_(R,[["render",V]]),X={props:{description:{type:String,default:""}}},W=["innerHTML"];function K(t,e,i,o,s,u){return n(),c("div",{id:"quiz-description",class:"quiz-description",innerHTML:this.description},null,8,W)}const G=_(X,[["render",K]]),Y={props:{feedback:{type:Object,default:{text:{type:String,default:""},class:{type:String,default:""}}}}},tt=["innerHTML"];function et(t,e,i,o,s,u){return n(),c("div",{class:O(["quiz-question__feedback",this.feedback.class]),innerHTML:this.feedback.text},null,10,tt)}const it=_(Y,[["render",et]]),st={components:{QuizQuestionFeedback:it},props:{questions:{type:Object,default:{}},questionsFeedback:{type:Object,default:{}},showFeedback:{type:Boolean,default:!1}}},nt={id:"quiz-questions",class:"quiz-questions"},ot=["innerHTML"],ut=["innerHTML","id"],rt=["name","value"],at=["name","id"];function lt(t,e,i,o,s,u){const h=m("QuizQuestionFeedback");return n(),c("div",nt,[(n(!0),c($,null,x(this.questions,a=>(n(),c("div",{key:a.id,class:"quiz-question"},[r("div",{class:"quiz-question__text",innerHTML:a.text},null,8,ot),r("fieldset",{name:"quiz_question_options",class:"quiz-question__options",innerHTML:a.options,id:"quiz-question-options-"+a.id},null,8,ut),r("input",{type:"hidden",name:"quiz[question]["+a.id+"][id]",value:a.id},null,8,rt),r("input",{type:"hidden",name:"quiz[question]["+a.id+"][answer]",value:"",id:"questionAnswer"+a.id},null,8,at),this.showFeedback?(n(),p(h,{key:0,feedback:this.questionsFeedback[a.id]},null,8,["feedback"])):l("",!0)]))),128))])}const dt=_(st,[["render",lt]]),pt={data(){return{buttons:{start:"Start",next:"Next",prev:"Prev",skip:"Skip",continue:"Continue",finish:"Finish",quit:"Quit"}}},props:{action:{type:String,default:""},disabled:{type:Boolean,default:!1}},mounted(){this.buttons={start:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_START","Start"),next:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_NEXT","Next"),prev:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_PREV","Prev"),skip:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_SKIP","Skip"),continue:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_CONTINUE","Continue"),finish:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_FINISH","Finish"),quit:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_QUIT","Quit")}}},ct=["disabled"];function ht(t,e,i,o,s,u){return n(),c("button",{class:O(["quiz-action btn",this.action]),disabled:this.disabled},f(this.buttons[this.action]),11,ct)}const mt=_(pt,[["render",ht]]),_t={components:{Preloader:k},props:{resultQuizId:{type:Number,required:!0,default:0},isLP:{type:Boolean,default:!1}},inject:["Joomla"],data(){return{resultHtml:"",isLoading:!0}},watch:{resultQuizId:{immediate:!0,handler(t){t>0&&this.fetchResultData(t)}}},methods:{async fetchResultData(t){this.isLoading=!0;try{const e=new FormData;e.append("quiz[resultQuizId]",t),e.append("quiz[action]","result"),e.append("quiz[isLP]",this.isLP),e.append(this.Joomla.getOptions("com_quiztools.token").value,1);const i=await g.post("/index.php?option=com_quiztools&task=ajaxQuiz.getQuizData",e);if(i.data.success===!0)if(i.data.data.redirect&&i.data.data.redirect.redirectAfterFinish&&parseInt(i.data.data.redirect.redirectAfterFinish)===1){const o=parseInt(i.data.data.redirect.redirectAfterFinishDelay);o>0&&(this.resultHtml=i.data.data.html),setTimeout(()=>{window.location.href=i.data.data.redirect.redirectAfterFinishLink},o*1e3)}else this.resultHtml=i.data.data.html;else Joomla.renderMessages({warning:[i.data.message]})}catch(e){Joomla.renderMessages({error:[e.message]})}finally{this.isLoading=!1}}}},ft={class:"quiz-result"},Qt=["innerHTML"];function qt(t,e,i,o,s,u){const h=m("Preloader");return n(),c("div",ft,[S(h,{isLoading:s.isLoading},null,8,["isLoading"]),r("div",{innerHTML:this.resultHtml},null,8,Qt)])}const Tt=_(_t,[["render",qt]]),zt={components:{Preloader:k,QuizCountQuestions:J,QuizAnswerPoints:D,QuizTimer:j,QuizDescription:G,QuizQuestion:dt,QuizButtonAction:mt,QuizResult:Tt},data(){return{quiz:{},resultQuizId:0,uniqueId:"",token:"",action:"",started:!1,isLoading:!1,form:null,sumTimeSpent:0,questions:{},questionsFeedback:{},showFeedback:!1,nextData:{},firstQuestionId:0,isFirstQuestion:!0,lastQuestionId:0,isLastQuestion:!1,numberCurrentQuestion:1,totalQuestions:1,pointsCurrentQuestion:0,unansweredQuestionsIds:[],isLP:!1,lp:{}}},methods:{clickButtonAction(t){if(Joomla.removeMessages(),this.lp&&this.lp.nextStep&&(this.lp.nextStep=null),this.action=t,["next","prev","finish"].includes(t)){if(!(t==="finish"&&this.quiz.skip_questions===2)){let e=this.validateForm();if(!e.result){Joomla.renderMessages({warning:[e.message]});return}}}else if(t==="continue"){this.actionContinue();return}this.isLoading=!0,setTimeout(async()=>{let e=new FormData(this.form);e.append(this.token,1);try{await g.post("/index.php?option=com_quiztools&task=ajaxQuiz.getQuizData",e).then(i=>{i.data.success===!0?this.processingResponse(i.data.data):i.data.message&&Joomla.renderMessages({warning:[i.data.message]})}).finally(()=>{this.isLoading=!1,this.started=!0})}catch(i){Joomla.renderMessages({error:[i.message]})}},50)},processingResponse(t){if(this.nextData={},this.questionsFeedback={},this.showFeedback=!1,t.hasOwnProperty("lpNextStepData")&&t.lpNextStepData.nextStep&&(this.lp.nextStep=t.lpNextStepData.nextStep),t.hasOwnProperty("questionsFeedback")){this.questionsFeedback=t.questionsFeedback,this.showFeedback=!0,delete t.questionsFeedback,this.nextData=t;return}if(t.hasOwnProperty("task")){if(t.task==="timeIsUp"){Joomla.renderMessages({warning:[Joomla.Text._("COM_QUIZTOOLS_QUIZ_ERROR_QUIZ_TIME_UP")]}),this.action="result";return}this.action=t.task}if(t.hasOwnProperty("firstQuestionId")&&(this.firstQuestionId=parseInt(t.firstQuestionId)),t.hasOwnProperty("lastQuestionId")&&(this.lastQuestionId=parseInt(t.lastQuestionId)),this.quiz.questions_on_page!==1&&t.hasOwnProperty("currentQuestionId")&&(this.isFirstQuestion=parseInt(t.currentQuestionId)===parseInt(this.firstQuestionId),this.isLastQuestion=parseInt(t.currentQuestionId)===parseInt(this.lastQuestionId)),t.hasOwnProperty("resultQuizId")&&(this.resultQuizId=parseInt(t.resultQuizId)),t.hasOwnProperty("uniqueId")&&(this.uniqueId=t.uniqueId),t.hasOwnProperty("questionsCountTotal")&&(this.totalQuestions=parseInt(t.questionsCountTotal)),t.hasOwnProperty("numberCurrentQuestion")&&(this.numberCurrentQuestion=parseInt(t.numberCurrentQuestion)),t.hasOwnProperty("sumTimeSpent")&&(this.sumTimeSpent=t.sumTimeSpent),t.hasOwnProperty("unansweredQuestionsIds")&&(this.unansweredQuestionsIds=t.unansweredQuestionsIds),t.hasOwnProperty("questions")){this.questions=t.questions;let e=0;this.questions.forEach(function(i){i.hasOwnProperty("points")&&(e+=parseFloat(i.points)),i.hasOwnProperty("noAttemptsLeft")&&parseInt(i.noAttemptsLeft)===1&&(Joomla.renderMessages({warning:[Joomla.Text._("COM_QUIZTOOLS_QUIZ_ERROR_QUESTION_NO_ATTEMPTS_LEFT")]}),this.action="result")}),this.pointsCurrentQuestion=e}},validateForm(){let t=!1,e={result:!0,message:""},i=new FormData(this.form);return this.form.reportValidity()||(t=!0),i.forEach((o,s)=>{let u=this.form[`${s}`];u instanceof Node&&u.hasAttribute("required")&&!u.classList.contains("valid")&&(t=!0)}),this.questions[0]!==void 0&&this.questions.forEach(o=>{Quiztools[o.type].validateAnswer!==void 0&&!Quiztools[o.type].validateAnswer(o.id)&&(t=!0)}),t&&(e={result:!1,message:Joomla.Text._("COM_QUIZTOOLS_QUIZ_ERROR_VALIDATION")}),e},actionContinue(){let t=this.nextData;this.processingResponse(t)},updateSumTimeSpent(t){this.sumTimeSpent=t},updateAction(t){this.action=t},parseNestedParams(t){const e=new URLSearchParams(t),i={};for(const[o,s]of e.entries()){const u=o.replace(/\]/g,"").split(/\[|\]/g);let h=i;for(let a=0;a<u.length;a++){const Q=u[a];a===u.length-1?h[Q]=s:(Q in h||(h[Q]={}),h=h[Q])}}return i}},watch:{action(t){t==="result"&&this.isLP===!0&&this.lp?.nextStep&&window.parent.postMessage({quizFinished:!0,lpNextStep:JSON.stringify(this.lp.nextStep)},"*")}},mounted(){this.form=document.querySelector("#quizForm"),this.token=Joomla.getOptions("com_quiztools.token").value,this.quiz=Joomla.getOptions("com_quiztools.quiz"),this.quiz.quiz_autostart===1&&(this.started=!0,this.clickButtonAction("start")),this.quiz.questions_on_page===1&&(this.isFirstQuestion=!0,this.isLastQuestion=!0);const t=this.parseNestedParams(window.location.search);t.lp&&(this.isLP=!0,this.lp=t.lp)}},It={id:"quiz-app",class:"quiz-app"},Ot={key:0},kt={class:"quiz-header"},gt={key:0,class:"quiz-header__data"},St={class:"quiz-main"},yt=["value"],bt={class:"quiz-actions"};function wt(t,e,i,o,s,u){const h=m("QuizCountQuestions"),a=m("QuizAnswerPoints"),Q=m("QuizTimer"),b=m("Preloader"),w=m("QuizDescription"),L=m("QuizQuestion"),q=m("QuizButtonAction"),C=m("QuizResult");return n(),c("div",It,[this.action!=="result"?(n(),c("div",Ot,[r("div",kt,[this.started&&(this.quiz.question_number===1||this.quiz.question_points===1||this.quiz.timer_show===1)?(n(),c("div",gt,[this.quiz.question_number===1&&this.quiz.questions_on_page===0?(n(),p(h,{key:0,numberCurrentQuestion:s.numberCurrentQuestion,totalQuestions:s.totalQuestions},null,8,["numberCurrentQuestion","totalQuestions"])):l("",!0),this.quiz.question_points===1&&this.quiz.questions_on_page===0&&this.questions[0].type!=="boilerplate"?(n(),p(a,{key:1,pointsCurrentQuestion:s.pointsCurrentQuestion},null,8,["pointsCurrentQuestion"])):l("",!0),this.quiz.allow_continue===0&&this.quiz.timer_show===1&&this.quiz.limit_time>0?(n(),p(Q,{key:2,timerStyle:this.quiz.timer_style,limitTime:this.quiz.limit_time,sumTimeSpent:s.sumTimeSpent,onUpdateSumTimeSpent:u.updateSumTimeSpent,action:s.action,onUpdateAction:u.updateAction},null,8,["timerStyle","limitTime","sumTimeSpent","onUpdateSumTimeSpent","action","onUpdateAction"])):l("",!0)])):l("",!0)]),r("div",St,[S(b,{isLoading:s.isLoading},null,8,["isLoading"]),r("form",{onSubmit:e[4]||(e[4]=U(()=>{},["prevent"])),action:"#",name:"quiz_form",id:"quizForm",class:"form-validate"},[this.quiz.quiz_autostart===0&&!this.started?(n(),p(w,{key:0,description:this.quiz.description},null,8,["description"])):l("",!0),this.started?(n(),p(L,{key:1,questions:s.questions,questionsFeedback:s.questionsFeedback,showFeedback:s.showFeedback},null,8,["questions","questionsFeedback","showFeedback"])):l("",!0),T(r("input",{type:"hidden",name:"quiz[id]","onUpdate:modelValue":e[0]||(e[0]=d=>this.quiz.id=d)},null,512),[[z,this.quiz.id]]),T(r("input",{type:"hidden",name:"quiz[resultQuizId]","onUpdate:modelValue":e[1]||(e[1]=d=>this.resultQuizId=d)},null,512),[[z,this.resultQuizId]]),T(r("input",{type:"hidden",name:"quiz[uniqueId]","onUpdate:modelValue":e[2]||(e[2]=d=>this.uniqueId=d)},null,512),[[z,this.uniqueId]]),T(r("input",{type:"hidden",name:"quiz[action]","onUpdate:modelValue":e[3]||(e[3]=d=>this.action=d)},null,512),[[z,this.action]]),r("input",{type:"hidden",name:"quiz[lp]",value:JSON.stringify(this.lp)},null,8,yt)],32)]),r("div",bt,[this.started&&!this.showFeedback&&this.quiz.questions_on_page===0&&this.quiz.skip_questions>0?(n(),p(q,{key:0,action:"skip",disabled:this.isLoading,onClick:e[5]||(e[5]=d=>this.clickButtonAction("skip"))},null,8,["disabled"])):l("",!0),this.started&&!this.showFeedback&&this.quiz.questions_on_page===0&&this.quiz.enable_prev_button===1&&!this.isFirstQuestion?(n(),p(q,{key:1,action:"prev",disabled:this.isLoading,onClick:e[6]||(e[6]=d=>this.clickButtonAction("prev"))},null,8,["disabled"])):l("",!0),this.started&&!this.showFeedback&&this.quiz.questions_on_page===0&&(this.quiz.skip_questions===0&&!this.isLastQuestion||this.quiz.skip_questions===1&&(!this.isLastQuestion||this.unansweredQuestionsIds.length>1||this.unansweredQuestionsIds.length===1&&parseInt(this.unansweredQuestionsIds[0])!==this.questions[0].id)||this.quiz.skip_questions===2&&!this.isLastQuestion)?(n(),p(q,{key:2,action:"next",disabled:this.isLoading,onClick:e[7]||(e[7]=d=>this.clickButtonAction("next"))},null,8,["disabled"])):l("",!0),this.started&&!this.showFeedback&&(this.quiz.questions_on_page===0&&(this.unansweredQuestionsIds.length===0||this.unansweredQuestionsIds.length===1&&parseInt(this.unansweredQuestionsIds[0])===this.questions[0].id||this.quiz.skip_questions===2)||this.quiz.questions_on_page===1)?(n(),p(q,{key:3,action:"finish",disabled:this.isLoading,onClick:e[8]||(e[8]=d=>this.clickButtonAction("finish"))},null,8,["disabled"])):l("",!0),this.started&&this.showFeedback?(n(),p(q,{key:4,action:this.nextData.task!=="result"?"continue":"quit",disabled:this.isLoading,onClick:e[9]||(e[9]=d=>this.clickButtonAction("continue"))},null,8,["action","disabled"])):l("",!0),this.started?l("",!0):(n(),p(q,{key:5,action:"start",disabled:this.isLoading,onClick:e[10]||(e[10]=d=>this.clickButtonAction("start"))},null,8,["disabled"]))])])):l("",!0),this.action==="result"?(n(),p(C,{key:1,resultQuizId:s.resultQuizId,isLP:s.isLP},null,8,["resultQuizId","isLP"])):l("",!0)])}const Lt=_(zt,[["render",wt]]),y=v(Lt);y.provide("Joomla",Joomla);y.mount("#quiz-wrap");
