import{i as F,a as Q,o as i,v as E,b as p,t as b,u as P,r as u,d as R,e as W,F as oe,h as le,f as I,g as f,w as K,m as G,_ as Y,q as ee,x as X,y as re,z as M,A as w,s as de}from"./vendor.min.js";const ce={id:"quiz-count-questions",class:"quiz-count-questions"},_e={id:"quiz-number-current"},pe={id:"quiz-number-total"},me={__name:"QuizCountQuestions",props:{numberCurrentQuestion:{type:Number,default:0},totalQuestions:{type:Number,default:0}},setup(o){const t=F("Joomla");return(a,l)=>(i(),Q("div",ce,[E(b(P(t).Text._("COM_QUIZTOOLS_QUIZ_COMPONENT_COUNT_QUESTIONS_TEXT_QUESTION"))+" ",1),p("span",_e,b(o.numberCurrentQuestion),1),E(" "+b(P(t).Text._("COM_QUIZTOOLS_QUIZ_COMPONENT_COUNT_QUESTIONS_TEXT_OF"))+" ",1),p("span",pe,b(o.totalQuestions),1)]))}},ve={id:"quiz-answer-points",class:"quiz-answer-points"},fe={__name:"QuizAnswerPoints",props:{pointsCurrentQuestion:{type:Number,default:0}},setup(o){const t=F("Joomla");return(a,l)=>(i(),Q("div",ve,[E(b(P(t).Text._("COM_QUIZTOOLS_QUIZ_COMPONENT_ANSWER_POINTS_TEXT_POINTS"))+" ",1),p("span",null,b(o.pointsCurrentQuestion?o.pointsCurrentQuestion:0),1)]))}},Te=["innerHTML"],Ie={__name:"QuizTimer",props:{timerStyle:{type:Number,default:0},limitTime:{type:Number,default:0},sumTimeSpent:{type:Number,default:0}},emits:["update-sumTimeSpent","update-action"],setup(o,{emit:t}){const a=o,l=t,q=F("Joomla"),c=u("00:00:00");let r=null;function d(v){const _=(v%60).toString(),S=Math.floor(v/60%60).toString();return{h:Math.floor(v/60/60%60).toString(),m:S,s:_}}function m(v){const _=d(v);return`${_.h.padStart(2,"0")}:${_.m.padStart(2,"0")}:${_.s.padStart(2,"0")}`}function O(v){const _=m(v),S=m(parseInt(a.limitTime)*60);return _+'<span class="quiz-timer__limit">'+q.Text._("COM_QUIZTOOLS_QUIZ_COMPONENT_TIMER_TEXT_OF")+S+"</span>"}function T(){const v=parseInt(a.limitTime)*60-parseInt(a.sumTimeSpent);if(v<0){clearInterval(r),r=null,q.renderMessages({warning:[q.Text._("COM_QUIZTOOLS_QUIZ_ERROR_QUIZ_TIME_UP")]}),l("update-action","finish");return}a.timerStyle===0?c.value=m(a.sumTimeSpent):a.timerStyle===1?c.value=m(v):a.timerStyle===2&&(c.value=O(a.sumTimeSpent)),l("update-sumTimeSpent",a.sumTimeSpent+1)}return R(()=>{r||(r=setInterval(T,1e3))}),(v,_)=>(i(),Q("div",{id:"quiz-timer",class:"quiz-timer",innerHTML:c.value},null,8,Te))}},Qe=["innerHTML"],qe={__name:"QuizDescription",props:{description:{type:String,default:""}},setup(o){return(t,a)=>(i(),Q("div",{id:"quiz-description",class:"quiz-description",innerHTML:o.description},null,8,Qe))}},Oe=["innerHTML"],Se={__name:"QuizQuestionFeedback",props:{feedback:{type:Object,default:()=>({text:"",class:""})}},setup(o){return(t,a)=>(i(),Q("div",{class:W(["quiz-question__feedback",o.feedback.class]),innerHTML:o.feedback.text},null,10,Oe))}},ze={id:"quiz-questions",class:"quiz-questions"},ke=["innerHTML"],ge=["innerHTML","id"],he=["name","value"],be=["name","id"],ye={__name:"QuizQuestion",props:{questions:{type:Object,default:()=>({})},questionsFeedback:{type:Object,default:()=>({})},showFeedback:{type:Boolean,default:!1}},setup(o){return(t,a)=>(i(),Q("div",ze,[(i(!0),Q(oe,null,le(o.questions,l=>(i(),Q("div",{key:l.id,class:"quiz-question"},[p("div",{class:"quiz-question__text",innerHTML:l.text},null,8,ke),p("fieldset",{name:"quiz_question_options",class:"quiz-question__options",innerHTML:l.options,id:"quiz-question-options-"+l.id},null,8,ge),p("input",{type:"hidden",name:"quiz[question]["+l.id+"][id]",value:l.id},null,8,he),p("input",{type:"hidden",name:"quiz[question]["+l.id+"][answer]",value:"",id:"questionAnswer"+l.id},null,8,be),o.showFeedback?(i(),I(Se,{key:0,feedback:o.questionsFeedback[l.id]},null,8,["feedback"])):f("",!0)]))),128))]))}},Ue=["disabled"],U={__name:"QuizButtonAction",props:{action:{type:String,default:""},disabled:{type:Boolean,default:!1}},setup(o){const t=u({start:"Start",next:"Next",prev:"Prev",skip:"Skip",continue:"Continue",finish:"Finish",quit:"Quit"});return R(()=>{t.value={start:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_START","Start"),next:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_NEXT","Next"),prev:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_PREV","Prev"),skip:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_SKIP","Skip"),continue:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_CONTINUE","Continue"),finish:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_FINISH","Finish"),quit:Joomla.Text._("COM_QUIZTOOLS_QUIZ_BUTTON_ACTION_QUIT","Quit")}}),(a,l)=>(i(),Q("button",{class:W(["quiz-action btn",o.action]),disabled:o.disabled},b(t.value[o.action]),11,Ue))}},Ne={class:"quiz-result"},Ce=["innerHTML"],xe={__name:"QuizResult",props:{resultQuizId:{type:Number,required:!0,default:0},isLP:{type:Boolean,default:!1}},setup(o){const t=o,a=F("Joomla"),l=u(""),q=u(!0);async function c(r){q.value=!0;try{const d=new FormData;d.append("quiz[resultQuizId]",r),d.append("quiz[action]","result"),d.append("quiz[isLP]",t.isLP),d.append(a.getOptions("com_quiztools.token").value,1);const m=await ee.post("/index.php?option=com_quiztools&task=ajaxQuiz.getQuizData",d);if(m.data.success===!0){const O=m.data.data.redirect;if(O&&parseInt(O.redirectAfterFinish)===1){const T=parseInt(O.redirectAfterFinishDelay);T>0&&(l.value=m.data.data.html),setTimeout(()=>{window.location.href=O.redirectAfterFinishLink},T*1e3)}else l.value=m.data.data.html}else a.renderMessages({warning:[m.data.message]})}catch(d){a.renderMessages({error:[d.message]})}finally{q.value=!1}}return K(()=>t.resultQuizId,r=>{r>0&&c(r)},{immediate:!0}),(r,d)=>(i(),Q("div",Ne,[G(Y,{isLoading:q.value},null,8,["isLoading"]),p("div",{innerHTML:l.value},null,8,Ce)]))}},Le={id:"quiz-app",class:"quiz-app"},Me={key:0},we={class:"quiz-header"},Fe={key:0,class:"quiz-header__data"},$e={class:"quiz-main"},Ze=["value"],Je={class:"quiz-actions"},Ae={__name:"Quiz",setup(o){const t=X({}),a=u(0),l=u(""),q=u(""),c=u(""),r=u(!1),d=u(!1),m=u(null),O=u(0),T=u([]),v=u({}),_=u(!1),S=u({}),$=u(0),Z=u(!0),D=u(0),N=u(!1),B=u(1),H=u(1),V=u(0),k=u([]),J=u(!1),z=X({});function g(e){if(Joomla.removeMessages(),z&&z.nextStep&&(z.nextStep=null),c.value=e,["next","prev","finish"].includes(e)){if(!(e==="finish"&&t.skip_questions===2)){const n=ne();if(!n.result){Joomla.renderMessages({warning:[n.message]});return}}}else if(e==="continue"){se();return}d.value=!0,setTimeout(async()=>{const n=new FormData(m.value);n.append(q.value,1);try{const s=await ee.post("/index.php?option=com_quiztools&task=ajaxQuiz.getQuizData",n);s.data.success===!0?j(s.data.data):s.data.message&&Joomla.renderMessages({warning:[s.data.message]})}catch(s){Joomla.renderMessages({error:[s.message]})}finally{d.value=!1,r.value=!0}},50)}function j(e){if(S.value={},v.value={},_.value=!1,e.lpNextStepData?.nextStep&&(z.nextStep=e.lpNextStepData.nextStep),e.questionsFeedback){v.value=e.questionsFeedback,_.value=!0,delete e.questionsFeedback,S.value=e;return}if(e.task){if(e.task==="timeIsUp"){Joomla.renderMessages({warning:[Joomla.Text._("COM_QUIZTOOLS_QUIZ_ERROR_QUIZ_TIME_UP")]}),c.value="result";return}c.value=e.task}if(e.firstQuestionId&&($.value=parseInt(e.firstQuestionId)),e.lastQuestionId&&(D.value=parseInt(e.lastQuestionId)),t.questions_on_page!==1&&e.currentQuestionId&&(Z.value=parseInt(e.currentQuestionId)===parseInt($.value),N.value=parseInt(e.currentQuestionId)===parseInt(D.value)),e.resultQuizId&&(a.value=parseInt(e.resultQuizId)),e.uniqueId&&(l.value=e.uniqueId),e.questionsCountTotal&&(H.value=parseInt(e.questionsCountTotal)),e.numberCurrentQuestion&&(B.value=parseInt(e.numberCurrentQuestion)),e.sumTimeSpent&&(O.value=e.sumTimeSpent),e.unansweredQuestionsIds&&(k.value=e.unansweredQuestionsIds),e.questions){T.value=e.questions;let n=0;T.value.forEach(s=>{s.points&&(n+=parseFloat(s.points)),s.noAttemptsLeft&&parseInt(s.noAttemptsLeft)===1&&(Joomla.renderMessages({warning:[Joomla.Text._("COM_QUIZTOOLS_QUIZ_ERROR_QUESTION_NO_ATTEMPTS_LEFT")]}),c.value="result")}),V.value=n}}function ne(){let e=!1,n={result:!0,message:""};const s=new FormData(m.value);return m.value.reportValidity()||(e=!0),s.forEach((y,A)=>{const h=m.value[`${A}`];h instanceof Node&&h.hasAttribute("required")&&!h.classList.contains("valid")&&(e=!0)}),T.value[0]!==void 0&&T.value.forEach(y=>{Quiztools[y.type]?.validateAnswer&&!Quiztools[y.type].validateAnswer(y.id)&&(e=!0)}),e&&(n={result:!1,message:Joomla.Text._("COM_QUIZTOOLS_QUIZ_ERROR_VALIDATION")}),n}function se(){j(S.value)}function ie(e){O.value=e}function ue(e){c.value=e}function ae(e){const n=new URLSearchParams(e),s={};for(const[y,A]of n.entries()){const h=y.replace(/\]/g,"").split(/\[|\]/g);let C=s;for(let x=0;x<h.length;x++){const L=h[x];x===h.length-1?C[L]=A:(L in C||(C[L]={}),C=C[L])}}return s}return K(c,e=>{e==="result"&&J.value===!0&&z?.nextStep&&window.parent.postMessage({quizFinished:!0,lpNextStep:JSON.stringify(z.nextStep)},"*")}),R(()=>{m.value=document.querySelector("#quizForm"),q.value=Joomla.getOptions("com_quiztools.token").value,Object.assign(t,Joomla.getOptions("com_quiztools.quiz")),t.quiz_autostart===1&&(r.value=!0,g("start")),t.questions_on_page===1&&(Z.value=!0,N.value=!0);const e=ae(window.location.search);e.lp&&(J.value=!0,Object.assign(z,e.lp))}),(e,n)=>(i(),Q("div",Le,[c.value!=="result"?(i(),Q("div",Me,[p("div",we,[r.value&&(t.question_number===1||t.question_points===1||t.timer_show===1)?(i(),Q("div",Fe,[t.question_number===1&&t.questions_on_page===0?(i(),I(me,{key:0,numberCurrentQuestion:B.value,totalQuestions:H.value},null,8,["numberCurrentQuestion","totalQuestions"])):f("",!0),t.question_points===1&&t.questions_on_page===0&&T.value[0]?.type!=="boilerplate"?(i(),I(fe,{key:1,pointsCurrentQuestion:V.value},null,8,["pointsCurrentQuestion"])):f("",!0),t.allow_continue===0&&t.timer_show===1&&t.limit_time>0?(i(),I(Ie,{key:2,timerStyle:t.timer_style,limitTime:t.limit_time,sumTimeSpent:O.value,onUpdateSumTimeSpent:ie,action:c.value,onUpdateAction:ue},null,8,["timerStyle","limitTime","sumTimeSpent","action"])):f("",!0)])):f("",!0)]),p("div",$e,[G(Y,{isLoading:d.value},null,8,["isLoading"]),p("form",{onSubmit:n[4]||(n[4]=re(()=>{},["prevent"])),action:"#",name:"quiz_form",id:"quizForm",class:"form-validate"},[t.quiz_autostart===0&&!r.value?(i(),I(qe,{key:0,description:t.description},null,8,["description"])):f("",!0),r.value?(i(),I(ye,{key:1,questions:T.value,questionsFeedback:v.value,showFeedback:_.value},null,8,["questions","questionsFeedback","showFeedback"])):f("",!0),M(p("input",{type:"hidden",name:"quiz[id]","onUpdate:modelValue":n[0]||(n[0]=s=>t.id=s)},null,512),[[w,t.id]]),M(p("input",{type:"hidden",name:"quiz[resultQuizId]","onUpdate:modelValue":n[1]||(n[1]=s=>a.value=s)},null,512),[[w,a.value]]),M(p("input",{type:"hidden",name:"quiz[uniqueId]","onUpdate:modelValue":n[2]||(n[2]=s=>l.value=s)},null,512),[[w,l.value]]),M(p("input",{type:"hidden",name:"quiz[action]","onUpdate:modelValue":n[3]||(n[3]=s=>c.value=s)},null,512),[[w,c.value]]),p("input",{type:"hidden",name:"quiz[lp]",value:JSON.stringify(z)},null,8,Ze)],32)]),p("div",Je,[r.value&&!_.value&&t.questions_on_page===0&&t.skip_questions>0?(i(),I(U,{key:0,action:"skip",disabled:d.value,onClick:n[5]||(n[5]=s=>g("skip"))},null,8,["disabled"])):f("",!0),r.value&&!_.value&&t.questions_on_page===0&&t.enable_prev_button===1&&!Z.value?(i(),I(U,{key:1,action:"prev",disabled:d.value,onClick:n[6]||(n[6]=s=>g("prev"))},null,8,["disabled"])):f("",!0),r.value&&!_.value&&t.questions_on_page===0&&(t.skip_questions===0&&!N.value||t.skip_questions===1&&(!N.value||k.value.length>1||k.value.length===1&&parseInt(k.value[0])!==T.value[0].id)||t.skip_questions===2&&!N.value)?(i(),I(U,{key:2,action:"next",disabled:d.value,onClick:n[7]||(n[7]=s=>g("next"))},null,8,["disabled"])):f("",!0),r.value&&!_.value&&(t.questions_on_page===0&&(k.value.length===0||k.value.length===1&&parseInt(k.value[0])===T.value[0].id||t.skip_questions===2)||t.questions_on_page===1)?(i(),I(U,{key:3,action:"finish",disabled:d.value,onClick:n[8]||(n[8]=s=>g("finish"))},null,8,["disabled"])):f("",!0),r.value&&_.value?(i(),I(U,{key:4,action:S.value.task!=="result"?"continue":"quit",disabled:d.value,onClick:n[9]||(n[9]=s=>g("continue"))},null,8,["action","disabled"])):f("",!0),r.value?f("",!0):(i(),I(U,{key:5,action:"start",disabled:d.value,onClick:n[10]||(n[10]=s=>g("start"))},null,8,["disabled"]))])])):f("",!0),c.value==="result"?(i(),I(xe,{key:1,resultQuizId:a.value,isLP:J.value},null,8,["resultQuizId","isLP"])):f("",!0)]))}},te=de(Ae);te.provide("Joomla",Joomla);te.mount("#quiz-wrap");
