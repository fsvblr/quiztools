import{i as _,r as c,c as P,a as m,o as r,b as S,n as U,d as I,t as $,u as y,e as B,f as w,g as h,F as q,h as R,w as z,j as C,k as D,l as j,m as F,_ as Q,p as L,q as V,s as Z}from"./vendor.min.js";const W=["aria-valuemax","aria-valuenow","aria-valuetext"],X={class:"lpath-progressbar__track"},Y=500,G="cubic-bezier(0.22, 1, 0.36, 1)",K={__name:"LpathProgressbar",setup(i){const a=_("countStepsTotal",c(0)),u=_("countStepsPassed",c(0)),l=P(()=>{const n=Number(a?.value??0);return n>0?n:0}),p=P(()=>{const n=Number(u?.value??0);return n<0?0:l.value>0?Math.min(n,l.value):0}),t=P(()=>l.value===0?0:Math.round(p.value/l.value*100)),d=P(()=>({width:`${t.value}%`,transition:`width ${Y}ms ${G}`}));return(n,T)=>(r(),m("div",{class:"lpath-progressbar",role:"progressbar","aria-valuemin":0,"aria-valuemax":l.value,"aria-valuenow":p.value,"aria-valuetext":`${t.value}%`},[S("div",X,[S("div",{class:"lpath-progressbar__fill",style:U(d.value)},null,4)])],8,W))}},ee=["disabled"],E={__name:"LpathButtonAction",props:{type:{type:String,default:"steps"},step:{type:Object,default:null}},setup(i){const a=i,u=c({steps:"To the list of steps",step:"Start",next:"Next: "});I(()=>{u.value={steps:l.Text._("COM_QUIZTOOLS_LPATH_BUTTON_ACTION_STEPS","To the list of steps"),step:l.Text._("COM_QUIZTOOLS_LPATH_BUTTON_ACTION_STEP","Start"),next:l.Text._("COM_QUIZTOOLS_LPATH_BUTTON_ACTION_NEXT","Next: ")+a.step?.title}});const l=_("Joomla"),p=_("isLoading",c(!1)),t=_("clickButtonAction",null),d=()=>{t&&t({type:a.type,step:a.step})};return(n,T)=>(r(),m("button",{class:B(["lpath-action btn",i.type]),disabled:y(p),onClick:d},$(u.value[i.type]),11,ee))}},te={class:"lpath-steps-wrap"},se={id:"lpath-steps",class:"lpath-steps"},ae={class:"step-title"},ne=["innerHTML"],oe={class:"btn-step"},le={__name:"LpathSteps",props:{steps:{type:Array,default:()=>[]}},setup(i){const a=_("Joomla"),u=_("showProgressbar");return(l,p)=>(r(),m("div",te,[y(u)&&i.steps?(r(),w(K,{key:0})):h("",!0),S("h4",null,$(y(a).Text._("COM_QUIZTOOLS_LPATH_TITLE_COURSE_STRUCTURE")),1),S("div",se,[(r(!0),m(q,null,R(i.steps,t=>(r(),m("div",{key:t.uniqueId+"-"+t.passed+"-"+t.canStart,class:B(["lpath-step",t.passed?"passed":""])},[S("h6",ae,$(t.title),1),t.desc!==""?(r(),m("div",{key:0,class:"step-desc",innerHTML:t.desc},null,8,ne)):h("",!0),S("div",oe,[t.canStart?(r(),w(E,{key:0,type:"step",step:t},null,8,["step"])):h("",!0)])],2))),128))])]))}},re={class:"lpath-step-wrap"},ie={class:"btn-list top"},ce=["src"],ue={key:1,class:"btn-list bottom"},pe={__name:"LpathStep",props:{step:{type:Object,default:()=>({})}},emits:["loaded"],setup(i,{emit:a}){const u=i,l=a,p=c(null),t=c(!1),d=c(!1);let n=null,T=null;const g=_("clickButtonAction"),b=_("nextStep");function x(){try{const e=p.value,s=e.contentDocument||e.contentWindow.document;e.style.height="auto";const f=Math.max(s.body.scrollHeight,s.documentElement.scrollHeight);e.style.height=f+"px"}catch{}}function O(){const e=p.value,s=e.contentDocument||e.contentWindow.document;A(s),n=new MutationObserver(()=>{x(),A(s)}),n.observe(s.body,{childList:!0,subtree:!0,attributes:!0,characterData:!0})}function A(e){function s(o){o.addEventListener("click",v=>{v.preventDefault();const k=o.getAttribute("href");if(k)try{const M=e.location.href,J=new URL(k,M).href;window.open(J,"_blank")}catch{}})}e.querySelectorAll("a").forEach(o=>s(o)),new MutationObserver(o=>{o.forEach(v=>{v.addedNodes.forEach(k=>{k.nodeType===1&&(k.tagName==="A"?s(k):k.querySelectorAll?.("a").forEach(M=>s(M)))})})}).observe(e.body,{childList:!0,subtree:!0})}function N(){window.scrollY>0&&window.scrollTo({top:0,behavior:"smooth"})}return z(()=>u.step,async e=>{if(!e||!e.link){n&&n.disconnect(),t.value=!1,d.value=!1;return}await C();const s=p.value;s&&(s.addEventListener("load",()=>{if(x(),O(),t.value=!0,l("loaded"),d.value=!0,e.type==="a"){g({type:"markArticle",step:e,stepStage:"start"});let f=e.minTime&&parseInt(e.minTime)?parseInt(e.minTime):10;T=setTimeout(()=>{g({type:"markArticle",step:u.step,stepStage:"finish"})},f*1e3)}},{once:!0}),s.addEventListener("error",()=>{d.value=!0},{once:!0}))},{immediate:!0}),D(()=>{n&&n.disconnect(),T&&clearTimeout(T)}),(e,s)=>(r(),m("div",re,[S("div",ie,[d.value?(r(),w(E,{key:0,type:"steps",step:i.step},null,8,["step"])):h("",!0)]),i.step&&i.step.link?(r(),m("iframe",{key:0,ref_key:"iframeRef",ref:p,src:i.step.link,id:"step-iframe",class:B(["animated-iframe",{"is-visible":t.value}])},null,10,ce)):h("",!0),i.step.type==="a"||i.step.type==="q"&&y(b)&&y(b).canStart&&t.value?(r(),m("div",ue,[y(b)&&y(b).canStart?(r(),w(E,{key:0,type:"next",step:y(b),onClick:N},null,8,["step"])):h("",!0)])):h("",!0)]))}},de={id:"lpath-app",class:"lpath-app"},ve=["innerHTML"],me={__name:"Lpath",setup(i){const a=c({}),u=c(0),l=c(0),p=c(!1),t=c({}),d=c({}),n=c("steps"),T=c(""),g=c(!1),b=async(e,s=t.value,f=null)=>{const o=new FormData;o.append("lpath[id]",a.value.id),o.append("lpath[action]",e),o.append("lpath[step]",JSON.stringify(s)),o.append(T.value,1),e==="markArticle"&&f&&o.append("lpath[stepStage]",f);try{return(await V.post("/index.php?option=com_quiztools&task=ajaxLpath.getLpathData",o)).data}catch(v){return Joomla.renderMessages({error:[v.message]}),null}},x=async({type:e,step:s,stepStage:f=null})=>{if(Joomla.removeMessages(),d.value={},e==="next"&&(e="step"),e==="markArticle"){const v=await b(e,s||t.value,f);v?.success?O(v.data):v?.message&&Joomla.renderMessages({warning:[v.message]});return}if(n.value=e,g.value=!0,e==="step"){t.value=s||{};return}await C();const o=await b(e,t.value);o?.success?O(o.data):o?.message&&Joomla.renderMessages({warning:[o.message]}),g.value=!1},O=e=>{if(e.hasOwnProperty("markedType")){e.nextStep&&(d.value=e.nextStep);return}a.value.steps=[],u.value=0,l.value=0,t.value={},n.value="steps",e.hasOwnProperty("steps")&&(a.value.steps=e.steps.steps,u.value=parseInt(e.steps.countStepsTotal),l.value=parseInt(e.steps.countStepsPassed))};function A(){g.value=!1}function N(e){e.data?.quizFinished===!0&&e.data?.lpNextStep&&setTimeout(()=>{d.value=JSON.parse(e.data.lpNextStep)},5e3)}return L("showProgressbar",p),L("countStepsTotal",u),L("countStepsPassed",l),L("isLoading",g),L("clickButtonAction",x),L("nextStep",d),I(()=>{T.value=Joomla.getOptions("com_quiztools.token").value,a.value=Joomla.getOptions("com_quiztools.lpath"),u.value=parseInt(a.value.countStepsTotal),l.value=parseInt(a.value.countStepsPassed),p.value=!!Number(a.value.showProgressbar),window.addEventListener("message",N)}),j(()=>{window.removeEventListener("message",N)}),(e,s)=>(r(),m("div",de,[F(Q,{isLoading:g.value},null,8,["isLoading"]),n.value==="steps"&&a.value.description?(r(),m("div",{key:0,class:"lpath-desc",innerHTML:a.value.description},null,8,ve)):h("",!0),n.value==="steps"?(r(),w(le,{key:1,steps:a.value.steps},null,8,["steps"])):h("",!0),n.value==="step"?(r(),w(pe,{key:2,step:t.value,onLoaded:A},null,8,["step"])):h("",!0)]))}},H=Z(me);H.provide("Joomla",window.Joomla);H.mount("#lpath-wrap");
